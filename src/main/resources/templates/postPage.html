<!DOCTYPE html>
<html xmlns:th="https://thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title th:text="@{'Pul-[ ' + ${post.sub.name} + ' ' + ${post.title} + ' ]-sa'}"></title>
		<div th:replace="fragments/header :: header"></div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
		<script src="https://malsup.github.io/jquery.form.js"></script>

		<script>
			// wait for the DOM to be loaded
			$(document).ready(function() {
				// bind 'myForm' and provide a simple callback function
				$('#upvote').ajaxForm(function() {
					alert("Thank you for your upvote!");
				});
				$('#downvote').ajaxForm(function() {
					alert("Thank you for your downvote!");
				});
			});
		</script>
	</head>
	<body>
		<div th:object="${post}">
			<a th:href="@{'/p/' + *{sub.slug}}"><h1 th:text="*{sub.name}"></h1></a>
			<h2 th:text="*{title}"></h2>
			<h3 th:text="*{content.text}"></h3>
			<img th:src="*{content.image}"/>
			<div th:if="*{content.audio != ''}">
				<audio controls>
					<source th:src="@{*{content.audio}}" type="audio/mpeg">
					<source th:src="@{*{content.audio}}" type="audio/ogg">
					<source th:src="@{*{content.audio}}" type="audio/wav">
					Your browser does not support the audio element.
				</audio>
			</div>
			<div th:if="${content.recording != ''}">
				<audio controls>
					<source th:src="@{*{content.recording}}" type="audio/ogg">
					<source th:src="@{*{content.recording}}" type="audio/wav">
					Your browser does not support the audio element.
				</audio>
			</div>
			<p th:text="${post.created}"></p>
		</div>
		<div th:replace="fragments/reply :: replies"></div>
		<form enctype="multipart/form-data" action="#" th:action="@{/p/} + ${post.sub.slug} + '/' + ${post.postId}" method="post">
			<div>
				<input
					type="text"
					field="*{text}"
					name="text"
					id="text"
					placeholder="What's on your mind?">
				
				<label for="image">Image file</label>
				<input
					type="file"
					field="*{image}"
					name="image"
					id="image"
					accept="image/*">
				
				<input
					type="text"
					field="*{recording}"
					value="recording"
					onchange="test(this)"
					name="recording"
					id="recording"
					hidden>

				<label for="audio">Audio file</label>
				<input type="button" onclick="recordAudio(this, 'recording')" value="Record">
				<div th:replace="fragments/recorderScript :: recorderScript"></div>
				<input
					type="file"
					onchange="play(this)"
					value="*{audio}"
					name="audio"
					id="audio"
					accept="audio/*"
					capture>
				<div th:replace="fragments/playerScript :: playerScript"></div>
				<audio id="player" controls></audio>
			</div>
			<input type="submit" value="Add comment">
		</form>
	</body>
</html>