<div th:fragment="voteScript" th:remove="tag">
  <script>
    function updateReplyVotes() {
      let votes = document.getElementsByClassName('vote_reply');
      for (let vote of votes) {
        let result = fetch(vote.id + '/vote')
                .then((response) => {
                  if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                  }

                  return response.blob();
                })
                .then((response) => {
                  response.text().then((result) => {
                    vote.innerHTML = `${result}`;
                  });
                });
      }
    }

    function updatePostVotes() {
      let votes = document.getElementsByClassName('vote_post');
      for (let vote of votes) {
        let result = fetch(vote.id + '/vote')
                .then((response) => {
                  if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                  }

                  return response.blob();
                })
                .then((response) => {
                  response.text().then((result) => {
                    vote.innerHTML = `${result}`;
                  });
                });
      }
    }

    /* function enableButtons(enabled) {
        let upvoteButtons = document.getElementsByClassName('upvote');
        let downvoteButtons = document.getElementsByClassName('downvote');

        if(!enabled) {
            for (let button of upvoteButtons) {
                button.children[0].disabled = !enabled;
            }

            for (let button of downvoteButtons) {
                button.children[0].disabled = !enabled;
            }
        }
    }

    addEventListener('DOMContentLoaded', (event) => {
        let result = fetch("/username")
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }

                    return response.blob();
                })
                .then((response) => {
                    response.text().then((result) => {
                        if (result !== "") {
                            enableButtons(true);
                        }
                        else {
                            enableButtons(false);
                        }
                    });
                });
    }); */

    $(document).ready(function() {
      $('.upvote_reply').ajaxForm(function() {
        updateReplyVotes();
      });
      $('.downvote_reply').ajaxForm(function() {
        updateReplyVotes();
      });
      $('.upvote_post').ajaxForm(function() {
        updatePostVotes();
      });
      $('.downvote_post').ajaxForm(function() {
        updatePostVotes();
      });
    });
  </script>
</div>